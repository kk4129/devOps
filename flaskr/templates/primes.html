{% extends "layout/base.html" %}

{% block title %}
    Prime Number Generator | CI/CD Pipeline
{% endblock %}

{% block content %}

<div class="container mt-4">

    <!-- Header with CI/CD theme -->
    <div class="text-center mb-5">
        <div class="d-flex justify-content-center align-items-center mb-3">
            <div class="p-2 bg-primary bg-opacity-10 rounded-circle me-3">
                <i class="bi bi-git text-primary fs-2"></i>
            </div>
            <div class="p-2 bg-success bg-opacity-10 rounded-circle me-3">
                <i class="bi bi-gear text-success fs-2"></i>
            </div>
            <div class="p-2 bg-info bg-opacity-10 rounded-circle">
                <i class="bi bi-rocket-takeoff text-info fs-2"></i>
            </div>
        </div>
        <h2 class="fw-bold gradient-text">ðŸš€ Prime Number Generator</h2>
        <p class="text-muted">
            This demonstrates <span class="badge bg-primary">Continuous Integration</span> in action.  
            The backend computes prime numbers, while the frontend is deployed via <span class="badge bg-success">Continuous Deployment</span>.
        </p>
        <div class="d-flex justify-content-center mt-3">
            <span class="badge bg-light text-dark me-2"><i class="bi bi-check-circle me-1"></i>API Endpoint Tested</span>
            <span class="badge bg-light text-dark me-2"><i class="bi bi-check-circle me-1"></i>Build Successful</span>
            <span class="badge bg-light text-dark"><i class="bi bi-check-circle me-1"></i>Deployed</span>
        </div>
    </div>

    <!-- Error Display Section -->
    {% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i> {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- CI/CD Pipeline Visualization -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-0 bg-light bg-opacity-25">
                <div class="card-body">
                    <h6 class="card-title text-center mb-4">CI/CD Pipeline Visualization</h6>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-center">
                            <div class="p-3 bg-primary bg-opacity-10 rounded-circle d-inline-block">
                                <i class="bi bi-code-slash text-primary fs-4"></i>
                            </div>
                            <p class="mb-0 mt-2 small">Code Commit</p>
                        </div>
                        <div class="flex-grow-1 border-top border-primary border-2 mx-2"></div>
                        <div class="text-center">
                            <div class="p-3 bg-warning bg-opacity-10 rounded-circle d-inline-block">
                                <i class="bi bi-hammer text-warning fs-4"></i>
                            </div>
                            <p class="mb-0 mt-2 small">Build & Test</p>
                        </div>
                        <div class="flex-grow-1 border-top border-warning border-2 mx-2"></div>
                        <div class="text-center">
                            <div class="p-3 bg-info bg-opacity-10 rounded-circle d-inline-block">
                                <i class="bi bi-clipboard-check text-info fs-4"></i>
                            </div>
                            <p class="mb-0 mt-2 small">Integration</p>
                        </div>
                        <div class="flex-grow-1 border-top border-info border-2 mx-2"></div>
                        <div class="text-center">
                            <div class="p-3 bg-success bg-opacity-10 rounded-circle d-inline-block">
                                <i class="bi bi-rocket-takeoff text-success fs-4"></i>
                            </div>
                            <p class="mb-0 mt-2 small">Deploy</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prime Input Form - Styled as a CI/CD Build Trigger -->
    <div class="card border-0 shadow-lg p-4 mb-4 build-card">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-play-circle me-2"></i>Trigger Prime Calculation</h5>
            <span class="badge bg-primary">API v1.0</span>
        </div>
        <div class="card-body">
            <p class="text-muted mb-4">
                <i class="bi bi-info-circle me-1"></i> Enter a number to trigger the prime calculation pipeline. 
                This simulates a CI/CD job where the backend computes and returns results.
            </p>
            
            <form method="GET" action="/primes/">
                <div class="row">
                    <div class="col-md-8">
                        <div class="mb-3">
                            <label for="limit" class="form-label fw-bold">
                                <i class="bi bi-input-cursor me-1"></i> Enter a number (n):
                            </label>
                            <input 
                                type="number" 
                                class="form-control form-control-lg border-primary border-2" 
                                id="limit" 
                                name="limit" 
                                placeholder="Example: 100"
                                min="2"
                                max="10000"
                                required
                            >
                            <div class="form-text">Maximum value: 10,000 (for performance testing)</div>
                        </div>
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-lg btn-primary w-100 pipeline-btn" type="submit">
                            <i class="bi bi-play-fill me-2"></i> Run Pipeline
                        </button>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-light rounded">
                    <div class="d-flex">
                        <div class="me-3">
                            <i class="bi bi-lightning-charge text-warning fs-4"></i>
                        </div>
                        <div>
                            <h6 class="fw-bold">CI/CD Note</h6>
                            <p class="mb-0 small">This request triggers a backend computation that would be part of your automated testing pipeline. In a full CI/CD setup, this API endpoint would be tested automatically with each commit.</p>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Prime Results - Styled as a CI/CD Build Output -->
    {% if primes %}
    <div class="card border-0 shadow-lg p-4 mt-4 result-card">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-check-circle text-success me-2"></i>Pipeline Results</h5>
            <div>
                <span class="badge bg-success me-2">Build #{{ range(100, 200) | random }}</span>
                <span class="badge bg-info">Duration: {{ range(50, 500) | random }}ms</span>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="p-3 bg-success bg-opacity-10 rounded">
                        <h6><i class="bi bi-speedometer2 me-2"></i>Performance Metrics</h6>
                        <p class="mb-1 small">Numbers processed: <strong>{{ limit }}</strong></p>
                        <p class="mb-1 small">Primes found: <strong>{{ primes | length }}</strong></p>
                        <p class="mb-0 small">Success rate: <strong>100%</strong></p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="p-3 bg-primary bg-opacity-10 rounded">
                        <h6><i class="bi bi-git me-2"></i>Pipeline Status</h6>
                        <p class="mb-1 small">Endpoint: <code>/api/primes/</code></p>
                        <p class="mb-1 small">Status: <span class="text-success">âœ“ Success</span></p>
                        <p class="mb-0 small">Deployed: <strong>Just now</strong></p>
                    </div>
                </div>
            </div>
            
            <h6 class="border-bottom pb-2">Prime numbers up to {{ limit }}:</h6>
            <div class="mt-3 p-3 bg-dark text-light rounded font-monospace" style="max-height: 300px; overflow-y: auto;">
                <div class="row">
                    {% for prime in primes %}
                    <div class="col-6 col-md-4 col-lg-3 mb-2">
                        <span class="badge bg-secondary">{{ prime }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="mt-4 d-flex justify-content-between align-items-center">
                <div>
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-download me-1"></i> Export Results
                    </button>
                    <button class="btn btn-outline-success btn-sm ms-2">
                        <i class="bi bi-clipboard-check me-1"></i> Run Tests
                    </button>
                </div>
                <div class="text-muted small">
                    <i class="bi bi-clock-history me-1"></i> Generated via CI/CD Pipeline
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- CI/CD Actions -->
    <div class="row mt-5">
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-primary">
                <div class="card-body text-center">
                    <i class="bi bi-github fs-1 text-primary mb-3"></i>
                    <h5>Git Integration</h5>
                    <p class="small">This page is automatically deployed when changes are pushed to the main branch.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-success">
                <div class="card-body text-center">
                    <i class="bi bi-check-circle fs-1 text-success mb-3"></i>
                    <h5>Automated Testing</h5>
                    <p class="small">The prime calculation API is tested with each commit to ensure reliability.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-info">
                <div class="card-body text-center">
                    <i class="bi bi-rocket-takeoff fs-1 text-info mb-3"></i>
                    <h5>Auto Deployment</h5>
                    <p class="small">Successful builds are automatically deployed to production servers.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Back button -->
    <div class="text-center mt-5">
        <a href="/" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>

</div>

<!-- Add custom styles for CI/CD theme -->
<style>
    .gradient-text {
        background: linear-gradient(90deg, #0d6efd, #20c997);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        display: inline-block;
    }
    
    .build-card {
        border-left: 5px solid #0d6efd !important;
        transition: transform 0.3s ease;
    }
    
    .build-card:hover {
        transform: translateY(-5px);
    }
    
    .result-card {
        border-left: 5px solid #20c997 !important;
        animation: fadeIn 0.8s ease;
    }
    
    .pipeline-btn {
        background: linear-gradient(90deg, #0d6efd, #20c997);
        border: none;
        transition: all 0.3s ease;
    }
    
    .pipeline-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3);
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .font-monospace {
        font-family: 'Courier New', monospace;
    }
</style>

{% endblock %}